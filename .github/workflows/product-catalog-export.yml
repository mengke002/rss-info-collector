name: Product Catalog Export

on:
  # æ‰‹åŠ¨è§¦å‘
  workflow_dispatch:
    inputs:
      reason:
        description: 'å¯¼å‡ºåŸå› ï¼ˆå¯é€‰ï¼‰'
        required: false
        default: 'æ‰‹åŠ¨è§¦å‘äº§å“æ¸…å•å¯¼å‡º'

jobs:
  export_product_catalog:
    runs-on: ubuntu-latest
    env:
      # --- æ•°æ®åº“å¯†é’¥ ---
      DB_HOST: ${{ secrets.DB_HOST }}
      DB_PORT: ${{ secrets.DB_PORT }}
      DB_USER: ${{ secrets.DB_USER }}
      DB_PASSWORD: ${{ secrets.DB_PASSWORD }}
      DB_NAME: ${{ secrets.DB_NAME }}
      DB_SSL_MODE: ${{ secrets.DB_SSL_MODE }}
      # --- LLMå¯†é’¥ (è™½ç„¶æ­¤ä»»åŠ¡ä¸éœ€è¦LLMï¼Œä½†ä¿æŒç¯å¢ƒä¸€è‡´æ€§) ---
      OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
      OPENAI_BASE_URL: ${{ secrets.OPENAI_BASE_URL }}
      # --- Notioné›†æˆé…ç½® ---
      NOTION_INTEGRATION_TOKEN: ${{ secrets.NOTION_INTEGRATION_TOKEN }}
      NOTION_PARENT_PAGE_ID: ${{ secrets.NOTION_PARENT_PAGE_ID }}

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Set up Python 3.12
      uses: actions/setup-python@v4
      with:
        python-version: '3.12'

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt

    - name: Export product catalog
      run: |
        echo "è§¦å‘åŸå› : ${{ github.event.inputs.reason }}"
        python main.py --task product_catalog --output text

    - name: Summary
      if: always()
      run: |
        echo "âœ… äº§å“æ¸…å•å¯¼å‡ºä»»åŠ¡å·²å®Œæˆ"
        echo "ğŸ“‹ ä»»åŠ¡å·²å°†æ‰€æœ‰äº§å“ï¼ˆå»é‡åï¼‰ç”Ÿæˆæ¸…å•å¹¶æ¨é€åˆ° Notion"
